sudo: false
dist: focal
os: linux

arch:
  - amd64
  - arm64
  - ppc64le
  - s390x

language: go
go:
  - "1.15"

# Only clone the most recent commit.
git:
  depth: 1

before_install:
  # Dump environment variables
  - printenv

install:
  - "go get -u -v github.com/kevinburke/go-bindata/..."

before_script:
  - "make magneticod"
  - "make magneticow"
  - "make image"

jobs:
  include:
    - stage: analyse
      name: format
      script: make check-formatting
    - name: analyse
      script: make vet
    - stage: test
      script: make test
    - stage: "build magneticod"
      script: make magneticod
    - stage: "build magneticow"
      script: make magneticow
    - stage: "build docker image"
      script: make image
      arch: amd64